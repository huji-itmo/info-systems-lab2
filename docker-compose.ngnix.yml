services:
  ssh-tunnel:
    image: alpine:latest
    container_name: ssh-tunnel
    command: >
      sh -c "
        apk add --no-cache openssh-client &&
        mkdir -p /root/.ssh &&
        cp /ssh/id_rsa /root/.ssh/id_rsa &&
        chmod 600 /root/.ssh/id_rsa &&
        ssh-keyscan -H your-remote-server.com >> /root/.ssh/known_hosts &&
        ssh -N -o StrictHostKeyChecking=yes -L 8080:localhost:3000 -i /root/.ssh/id_rsa user@your-remote-server.com
      "
    volumes:
      - ./ssh:/ssh:ro
    restart: unless-stopped
    networks:
      - proxy-net

  nginx:
    image: nginx:alpine
    container_name: nginx-proxy
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    restart: unless-stopped
    depends_on:
      - ssh-tunnel
    networks:
      - proxy-net

networks:
  proxy-net:
    driver: bridge
